<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Blackbox Beast Search — AI-Powered Lightning Answers</title>
<style>
:root {
--bg-primary: #0a0a0a;
--bg-secondary: #111111;
--bg-tertiary: #1a1a1a;
--text-primary: #ffffff;
--text-secondary: rgba(255,255,255,0.7);
--text-muted: rgba(255,255,255,0.5);
--accent-primary: #8b5cf6; /* Purple */
--accent-secondary: #06b6d4; /* Cyan */
--accent-error: #ef4444;
--accent-success: #10b981;
--border: rgba(255,255,255,0.1);
--shadow: 0 8px 32px rgba(0,0,0,0.5);
--gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
--highlight: rgba(139,92,246,0.2);
--entity: rgba(6,182,212,0.2);
}

* {
box-sizing: border-box;
margin: 0;
padding: 0;
}

html, body {
height: 100%;
margin: 0;
background: var(--bg-primary);
font-family: 'JetBrains Mono', 'Fira Code', monospace;
color: var(--text-primary);
line-height: 1.6;
overflow-x: hidden;
}

.container {
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
min-height: 100vh;
background: radial-gradient(circle at center, var(--bg-secondary) 0%, var(--bg-primary) 100%);
}

.card {
width: 100%;
max-width: 1400px;
border-radius: 20px;
padding: 30px;
background: var(--bg-tertiary);
box-shadow: var(--shadow);
backdrop-filter: blur(20px);
border: 1px solid var(--border);
position: relative;
overflow: hidden;
animation: fadeIn 0.5s ease-in-out;
}

.card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 6px;
background: var(--gradient);
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

.header {
display: flex;
align-items: center;
gap: 20px;
margin-bottom: 30px;
}

.logo {
width: 60px;
height: 60px;
border-radius: 16px;
background: var(--gradient);
display: flex;
align-items: center;
justify-content: center;
font-weight: 700;
color: white;
font-size: 24px;
box-shadow: 0 8px 24px rgba(139,92,246,0.4);
animation: pulse 2s infinite;
}

@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.05); }
}

.title {
font-size: 28px;
font-weight: 700;
margin: 0;
background: var(--gradient);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.subtitle {
color: var(--text-secondary);
font-size: 16px;
margin-top: 8px;
font-weight: 400;
}

.controls {
display: flex;
gap: 16px;
flex-wrap: wrap;
margin-bottom: 24px;
}

.input {
flex: 1;
display: flex;
gap: 12px;
}

input[type=text] {
flex: 1;
padding: 16px 20px;
border-radius: 12px;
border: 2px solid var(--border);
background: var(--bg-secondary);
color: var(--text-primary);
font-size: 16px;
outline: none;
transition: all 0.3s ease;
font-family: inherit;
}

input[type=text]:focus {
border-color: var(--accent-primary);
box-shadow: 0 0 0 4px rgba(139,92,246,0.1);
background: var(--bg-tertiary);
}

.select, button {
padding: 14px 20px;
border-radius: 12px;
border: 2px solid var(--border);
background: var(--bg-secondary);
color: var(--text-primary);
cursor: pointer;
font-size: 14px;
font-family: inherit;
transition: all 0.3s ease;
}

.select:hover, button:hover {
border-color: var(--accent-primary);
background: var(--bg-tertiary);
}

button.primary {
background: var(--gradient);
color: white;
border: none;
font-weight: 600;
box-shadow: 0 8px 24px rgba(139,92,246,0.4);
}

button.primary:hover {
transform: translateY(-2px);
box-shadow: 0 12px 32px rgba(139,92,246,0.6);
}

.row {
display: flex;
gap: 16px;
align-items: center;
margin-bottom: 16px;
flex-wrap: wrap;
}

.small {
font-size: 14px;
color: var(--text-muted);
}

.status {
font-size: 15px;
color: var(--accent-success);
margin-bottom: 12px;
font-weight: 500;
}

.status.error {
color: var(--accent-error);
}

.answer {
margin-bottom: 24px;
padding: 24px;
border-radius: 16px;
background: var(--bg-secondary);
min-height: 120px;
font-size: 16px;
position: relative;
overflow: auto;
border: 1px solid var(--border);
line-height: 1.7;
}

.controls-bottom {
display: flex;
gap: 16px;
align-items: center;
margin-bottom: 20px;
flex-wrap: wrap;
}

.toggle {
cursor: pointer;
color: var(--accent-primary);
text-decoration: none;
font-size: 14px;
font-weight: 500;
transition: color 0.3s ease;
}

.toggle:hover {
color: var(--accent-secondary);
text-decoration: underline;
}

.proxy-list {
display: flex;
gap: 10px;
flex-wrap: wrap;
margin-bottom: 16px;
}

.proxy-pill {
padding: 8px 12px;
border-radius: 24px;
background: var(--bg-secondary);
border: 1px solid var(--border);
font-size: 12px;
color: var(--text-muted);
transition: background 0.3s ease;
}

.proxy-pill:hover {
background: var(--bg-tertiary);
}

.sources, .snippets, .codeview, .provenance {
margin-bottom: 20px;
padding: 20px;
border-radius: 16px;
background: var(--bg-secondary);
border: 1px solid var(--border);
}

.source-item {
margin-bottom: 16px;
padding: 12px;
border-radius: 12px;
background: var(--bg-tertiary);
border: 1px solid var(--border);
}

.source-item a {
color: var(--accent-primary);
text-decoration: none;
font-weight: 500;
}

.source-item a:hover {
text-decoration: underline;
color: var(--accent-secondary);
}

.snippet {
padding: 12px;
border-radius: 12px;
background: var(--bg-tertiary);
margin-bottom: 10px;
font-size: 14px;
border: 1px solid var(--border);
}

.highlight {
background: var(--highlight);
padding: 2px 6px;
border-radius: 6px;
font-weight: 600;
}

.entity {
background: var(--entity);
padding: 2px 6px;
border-radius: 6px;
font-weight: 600;
}

.code-block {
background: #0d1117;
padding: 16px;
border-radius: 12px;
color: #f0f6fc;
white-space: pre-wrap;
overflow: auto;
font-family: 'JetBrains Mono', monospace;
font-size: 14px;
border: 1px solid var(--border);
margin-bottom: 12px;
}

.runjs {
padding: 10px 16px;
border-radius: 10px;
background: var(--gradient);
color: white;
border: none;
cursor: pointer;
margin-top: 10px;
font-size: 13px;
font-weight: 500;
transition: transform 0.3s ease;
}

.runjs:hover {
transform: scale(1.05);
}

.download {
background: var(--gradient);
color: white;
border: none;
padding: 12px 20px;
border-radius: 12px;
cursor: pointer;
font-weight: 600;
box-shadow: 0 8px 24px rgba(139,92,246,0.4);
transition: all 0.3s ease;
}

.download:hover {
transform: translateY(-2px);
box-shadow: 0 12px 32px rgba(139,92,246,0.6);
}

.footer {
color: var(--text-muted);
font-size: 14px;
text-align: center;
margin-top: 24px;
font-weight: 400;
}

@media (max-width: 768px) {
.card {
padding: 20px;
}
.controls, .row, .controls-bottom {
flex-direction: column;
align-items: stretch;
}
.input {
flex-direction: column;
}
.title {
font-size: 24px;
}
}
</style>
<!-- Tesseract.js for OCR -->
<script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
</head>
<body>
<div class="container">
<div class="card" role="main" aria-live="polite">
<div class="header">
<div class="logo">B</div>
<div>
<div class="title">Blackbox Beast Search</div>
<div class="subtitle">AI-Powered Lightning Answers from Brave & Wikipedia. Sleek, Fast, and Unrestricted.</div>
</div>
</div>

<div class="controls">
<div class="input">
<input id="q" type="text" placeholder="Ask anything — get instant AI answers">
</div>
<select id="engine" class="select" title="Search engine">
<option value="brave">Brave AI (lightning fast)</option>
<option value="duckduckgo">DuckDuckGo</option>
<option value="bing">Bing</option>
<option value="wikipedia">Wikipedia Direct</option>
</select>
<select id="proxyMode" class="select" title="Proxy strategy">
<option value="auto">Proxy pool (recommended)</option>
<option value="single">First proxy only</option>
</select>
<button id="go" class="primary">Search</button>
</div>

<div class="row">
<div class="small">Spelling:</div>
<div id="correction" class="small" style="margin-left:6px;color:#ffd8a8"></div>
<div style="flex:1"></div>
<label style="cursor:pointer" class="small">
<input id="imgfile" type="file" accept="image/*" style="display:none"/>
<span style="padding:10px;border-radius:10px;border:2px solid var(--border);">Upload image (OCR)</span>
</label>
<button id="translateBtn" class="select">Translate</button>
</div>

<div id="status" class="small status">Ready for your query.</div>

<div id="answer" class="answer">Your AI-powered answer will appear here instantly.</div>

<div class="controls-bottom">
<div class="small">Show:</div>
<div id="toggleSources" class="toggle small">Sources</div>
<div id="toggleSnips" class="toggle small">Raw snippets</div>
<div id="toggleCode" class="toggle small">Code view</div>
<div class="small" style="margin-left:6px">Confidence: <span id="conf" class="small">—</span></div>
<div style="flex:1"></div>
<button id="downloadBtn" class="download">Download Answer</button>
</div>

<div id="sources" style="display:none;"></div>
<div id="snippets" style="display:none;"></div>
<div id="codeview" style="display:none;"></div>
<div id="provenance" class="provenance" style="display:none;"></div>

<div class="proxy-list" id="proxyList" aria-hidden="true"></div>

<div class="footer">Powered by Brave's AI search for speed. Proxies ensure privacy — results may vary.</div>
</div>
</div>

<script>
/* -------------------------
Blackbox Beast Search — Fixed & Working with Better Status & Fallbacks
- Brave AI integration with improved extraction
- Wikipedia fallback
- Blackbox AI-inspired dark, sleek design
- Enhanced status updates and error handling
------------------------- */

const proxies = [
"https://api.allorigins.win/get?url=",
"https://api.allorigins.cf/get?url=",
"https://api.codetabs.com/v1/proxy?quest=",
"https://thingproxy.freeboard.io/fetch/",
"https://corsproxy.io/?",
"https://cors-anywhere.herokuapp.com/"
];

const proxyListEl = document.getElementById('proxyList');
function showProxyList(){ proxyListEl.innerHTML=''; proxies.forEach(p=>{const d=document.createElement('div');d.className='proxy-pill';d.textContent=p;proxyListEl.appendChild(d)})}
showProxyList();

const qInput = document.getElementById('q');
const goBtn = document.getElementById('go');
const engineEl = document.getElementById('engine');
const proxyModeEl = document.getElementById('proxyMode');
const statusEl = document.getElementById('status');
const answerEl = document.getElementById('answer');
const sourcesEl = document.getElementById('sources');
const snippetsEl = document.getElementById('snippets');
const codeviewEl = document.getElementById('codeview');
const provEl = document.getElementById('provenance');
const confEl = document.getElementById('conf');
const correctionEl = document.getElementById('correction');
const toggleSourcesBtn = document.getElementById('toggleSources');
const toggleSnipsBtn = document.getElementById('toggleSnips');
const toggleCodeBtn = document.getElementById('toggleCode');
const imgfile = document.getElementById('imgfile');
const translateBtn = document.getElementById('translateBtn');
const downloadBtn = document.getElementById('downloadBtn');

const sleep = ms => new Promise(r => setTimeout(r, ms));

function escapeHtml(s){
if (s===null || s===undefined) return '';
return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
}

async function fetchWithTimeout(resource, options = {}) {
const { timeout = 20000 } = options;
const controller = new AbortController();
const id = setTimeout(() => controller.abort(), timeout);
const defaultHeaders = {
'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
'Accept-Language': 'en-US,en;q=0.5',
'Accept-Encoding': 'gzip, deflate',
'Connection': 'keep-alive',
'Upgrade-Insecure-Requests': '1',
};
try {
const response = await fetch(resource, { ...options, signal: controller.signal, headers: { ...defaultHeaders, ...options.headers } });
clearTimeout(id);
return response;
} catch (err) {
clearTimeout(id);
throw err;
}
}

async function fetchThroughProxy(proxyPrefix, targetUrl, timeout=20000){
try {
let url;
if (proxyPrefix.includes('corsproxy.io') && proxyPrefix.endsWith('?')) {
url = proxyPrefix + encodeURIComponent(targetUrl);
} else {
url = proxyPrefix + encodeURIComponent(targetUrl);
}
const resp = await fetchWithTimeout(url, { mode: 'cors', timeout });
if (!resp.ok) throw new Error('proxy returned ' + resp.status);
const text = await resp.text();
try {
const j = JSON.parse(text);
if (j.contents) return { html: j.contents, usedProxy: proxyPrefix };
if (j.content) return { html: j.content, usedProxy: proxyPrefix };
if (j.html) return { html: j.html, usedProxy: proxyPrefix };
if (j.data && typeof j.data === 'string') return { html: j.data, usedProxy: proxyPrefix };
} catch (e) {}
return { html: text, usedProxy: proxyPrefix };
} catch (err) {
throw err;
}
}

async function tryFetch(targetUrl, mode='auto'){
if (mode === 'single') {
const p = proxies[0];
statusEl.textContent = `Trying proxy: ${p}`;
try {
const r = await fetchThroughProxy(p, targetUrl, 15000);
if (r && r.html && r.html.length > 200) return r;
} catch (e) {
throw e;
}
}
for (let i=0;i<proxies.length;i++){
const p = proxies[i];
statusEl.textContent = `Trying proxy ${i+1}/${proxies.length}: ${p}`;
try {
const r = await fetchThroughProxy(p, targetUrl, 15000);
if (r && r.html && r.html.length > 200) return r;
} catch (e) {
console.warn('proxy failed', p, e && e.message);
await sleep(500);
continue;
}
}
statusEl.textContent = 'Trying direct fetch (may be blocked)...';
try {
const resp = await fetchWithTimeout(targetUrl, { timeout: 12000 });
const txt = await resp.text();
if (txt && txt.length > 200) return { html: txt, usedProxy: 'direct' };
throw new Error('direct fetch returned insufficient content');
} catch (err) {
throw new Error('All proxies + direct fetch failed: ' + (err.message || err));
}
}

function normalizeHref(href, baseUrl){
try {
return new URL(href, baseUrl).href;
} catch (e) {
return href;
}
}

function extractSnippetsAndLinksFromHTML(html, engine, baseUrl=''){
try {
const doc = new DOMParser().parseFromString(html, 'text/html');
const snippets = [];
const links = [];
const codes = [];
let nodeList = [];
if (engine === 'brave') {
nodeList = Array.from(doc.querySelectorAll('.answer, .ai-answer, .brave-answer, .snippet, .result, p, .b_algo p, .b_caption p, div[data-ved], .g'));
